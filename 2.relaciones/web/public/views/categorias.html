<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Categorías - CHAMANA</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-brand">
          <img src="/Chamana.png" alt="CHAMANA Logo" class="logo" />
          <div class="brand-text">
            <h1>Chamana</h1>
            <p>Somos Todas</p>
          </div>
        </div>
        <nav>
          <ul>
            <li><a href="/">Inicio</a></li>
            <li><a href="/productos">Prendas</a></li>
            <li><a href="/clientes">Clientes</a></li>
            <li><a href="/categorias">Categorías</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="main-content scrollable">
      <div class="container">
        <h2>Gestión de Categorías</h2>

        <div class="controls-section">
          <button class="btn btn-primary" onclick="showAddCategoryModal()">
            Agregar Categoría
          </button>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Total Prendas</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="categories-table-body">
              <tr>
                <td colspan="5" class="text-center">
                  <div class="loading">Cargando categorías...</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <div id="notification-container"></div>

    <script src="/js/api.js"></script>
    <script src="/js/main.js"></script>
    <script>
      let allCategories = [];

      document.addEventListener('DOMContentLoaded', function () {
        loadCategories();
      });

      async function loadCategories() {
        try {
          const response = await api.getCategorias();
          allCategories = response.data || [];
          renderCategories();
        } catch (error) {
          console.error('Error al cargar categorías:', error);
          document.getElementById('categories-table-body').innerHTML =
            '<tr><td colspan="5" class="text-center"><div class="error">Error al cargar categorías</div></td></tr>';
        }
      }

      function renderCategories() {
        const tbody = document.getElementById('categories-table-body');

        if (allCategories.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="text-center">
                <div class="loading">No hay categorías disponibles</div>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = allCategories
          .map(
            (categoria) => `
          <tr>
            <td>${categoria.id}</td>
            <td><strong>${categoria.nombre}</strong></td>
            <td>${categoria.descripcion || 'Sin descripción'}</td>
            <td class="text-center">${categoria.total_prendas || 0}</td>
            <td class="text-center">
              <div class="action-buttons">
                <button class="btn btn-sm btn-info" onclick="viewCategory(${
                  categoria.id
                })" title="Ver detalles">
                  Ver
                </button>
                <button class="btn btn-sm btn-warning" onclick="editCategory(${
                  categoria.id
                })" title="Editar">
                  Editar
                </button>
              </div>
            </td>
          </tr>
        `
          )
          .join('');
      }

      function showAddCategoryModal() {
        alert('Función de agregar categoría en desarrollo');
      }

      function viewCategory(id) {
        const categoria = allCategories.find((c) => c.id === id);
        if (categoria) {
          alert(
            `Categoría: ${categoria.nombre}\nDescripción: ${
              categoria.descripcion || 'Sin descripción'
            }\nTotal Prendas: ${categoria.total_prendas || 0}`
          );
        }
      }

      function editCategory(id) {
        alert('Función de edición en desarrollo');
      }
    </script>

    <style>
      .scrollable {
        overflow-y: auto;
        max-height: calc(100vh - 80px);
      }

      .controls-section {
        margin-bottom: 2rem;
      }

      .table-container {
        background: white;
        border-radius: 0.5rem;
        box-shadow: var(--shadow-soft);
        overflow-x: auto;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table thead {
        background: var(--forest-primary);
        color: var(--opal);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .data-table th {
        padding: 0.75rem;
        text-align: left;
        font-weight: 400;
        font-size: 0.875rem;
      }

      .data-table td {
        padding: 0.75rem;
        border-bottom: 1px solid var(--border);
        font-size: 0.875rem;
      }

      .data-table tr:hover {
        background: rgba(149, 157, 144, 0.05);
      }

      .action-buttons {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
      }

      .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
      }

      .btn-info {
        background: var(--meadow);
        color: white;
      }

      .btn-warning {
        background: var(--lily-secondary);
        color: var(--forest-primary);
      }

      .text-center {
        text-align: center;
      }

      .loading,
      .error {
        padding: 2rem;
        text-align: center;
        color: var(--text-light);
      }

      .error {
        color: var(--error);
      }
    </style>
  </body>
</html>
