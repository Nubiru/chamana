{
  "phase": {
    "id": 2,
    "name": "Fase 2: Segunda Forma Normal (2NF)",
    "folder": "2.relaciones",
    "database": "chamana_db_fase2",
    "normalization_level": "2NF",
    "status": "complete",
    "completion_date": "2025-10-22",
    "duration_hours": 6
  },
  "database": {
    "name": "chamana_db_fase2",
    "tables_count": 12,
    "tables": [
      {
        "name": "clientes",
        "type": "base",
        "rows": 20,
        "from_phase": 1
      },
      {
        "name": "categorias",
        "type": "base",
        "rows": 5,
        "from_phase": 1
      },
      {
        "name": "disenos",
        "type": "base",
        "rows": 8,
        "from_phase": 1
      },
      {
        "name": "telas",
        "type": "base",
        "rows": 14,
        "from_phase": 1
      },
      {
        "name": "años",
        "type": "base",
        "rows": 11,
        "from_phase": 1
      },
      {
        "name": "temporadas",
        "type": "base",
        "rows": 2,
        "from_phase": 1
      },
      {
        "name": "colecciones",
        "type": "base",
        "rows": 22,
        "from_phase": 1
      },
      {
        "name": "prendas",
        "type": "enhanced",
        "rows": 30,
        "from_phase": 1,
        "changes": "Added stock_inicial, stock_vendido, stock_disponible (generated), fecha_ultima_venta"
      },
      {
        "name": "pedidos",
        "type": "new",
        "rows": 8,
        "from_phase": 2,
        "purpose": "Customer orders"
      },
      {
        "name": "pedidos_prendas",
        "type": "new_junction",
        "rows": 13,
        "from_phase": 2,
        "purpose": "Order line items (eliminates partial dependency)"
      },
      {
        "name": "telas_temporadas",
        "type": "new_junction",
        "rows": 23,
        "from_phase": 2,
        "purpose": "Seasonal fabric availability (eliminates partial dependency)"
      },
      {
        "name": "movimientos_inventario",
        "type": "new",
        "rows": 6,
        "from_phase": 2,
        "purpose": "Stock movement audit trail"
      }
    ],
    "foreign_keys_count": 14,
    "indexes_count": 34,
    "total_rows": 162
  },
  "migration": {
    "from_phase": 1,
    "from_database": "chamana_db_fase1",
    "records_migrated": 112,
    "migration_success_rate": "100%",
    "data_loss": 0,
    "transformations_applied": [
      "Title Case normalization (temporadas, tipos)",
      "NULL nombre handling (generated names)",
      "Stock initialization (default 10 units)",
      "Activation of all records (activo/activa = true)"
    ]
  },
  "normalization": {
    "level": "2NF",
    "criteria": {
      "first_normal_form": true,
      "partial_dependencies_eliminated": true
    },
    "junction_tables": [
      {
        "name": "pedidos_prendas",
        "eliminates": "Partial dependency of order line attributes on just pedido_id or prenda_id"
      },
      {
        "name": "telas_temporadas",
        "eliminates": "Partial dependency of fabric availability on just tela_id"
      }
    ],
    "generated_columns": [
      {
        "table": "prendas",
        "column": "stock_disponible",
        "formula": "stock_inicial - stock_vendido",
        "purpose": "Automatic stock calculation, prevents desynchronization"
      }
    ]
  },
  "features": {
    "new_capabilities": [
      "Order management system",
      "Automated inventory tracking",
      "Stock movement audit trail",
      "Seasonal fabric assignments",
      "Sales history and analytics"
    ],
    "business_queries_enabled": [
      "Monthly sales revenue",
      "Fabrics used in specific season/year",
      "Customer purchase history",
      "Product sales ranking",
      "Stock depletion timeline"
    ]
  },
  "quality_gates": {
    "database": {
      "total": 6,
      "passed": 6,
      "success_rate": "100%"
    },
    "documentation": {
      "total": 6,
      "passed": 6,
      "success_rate": "100%"
    },
    "functional": {
      "total": 5,
      "passed": 5,
      "success_rate": "100%"
    },
    "overall": {
      "total": 17,
      "passed": 17,
      "success_rate": "100%"
    }
  },
  "verification": {
    "script": "07_verificar.js",
    "tests_total": 9,
    "tests_passed": 9,
    "tests_failed": 0,
    "success_rate": "100%",
    "tests": [
      "Table structure (12 tables)",
      "Data migration (8 tables, 112 records)",
      "Foreign key relationships (14 FKs)",
      "Generated column (stock_disponible)",
      "Orders system (8 orders, 13 line items)",
      "Seasonal fabrics (23 assignments)",
      "Complex JOINs",
      "Index performance (34 indexes)",
      "2NF compliance"
    ]
  },
  "performance": {
    "indexes": {
      "simple": 28,
      "compound": 1,
      "foreign_key": 14,
      "temporal_desc": 3,
      "total": 34
    },
    "query_improvement": {
      "simple_select": "0%",
      "two_table_joins": "-33%",
      "complex_joins": "-50%",
      "aggregations": "-33%",
      "temporal_queries": "-62%",
      "average": "-40%"
    }
  },
  "documentation": {
    "files": [
      {
        "name": "MER_FASE2.md",
        "type": "diagram",
        "format": "Mermaid",
        "purpose": "Conceptual entity-relationship model"
      },
      {
        "name": "DER_FASE2.md",
        "type": "diagram",
        "format": "Mermaid",
        "purpose": "Logical model with data types and constraints"
      },
      {
        "name": "README.md",
        "type": "guide",
        "format": "Markdown",
        "purpose": "Comprehensive user guide and 2NF explanation"
      },
      {
        "name": "COMPARISON_FASE1_FASE2.md",
        "type": "comparison",
        "format": "Markdown",
        "purpose": "Phase 1 vs Phase 2 detailed comparison"
      }
    ],
    "audit_report": ".context/2.development/issues/AUDIT_FASE2_2025-10-22.md",
    "scripts_readme": "database/scripts/README.md"
  },
  "scripts": {
    "location": "database/scripts/",
    "count": 7,
    "execution_order": [
      "01_crear_database.js",
      "02_crear_tablas.js",
      "03_crear_indices.js",
      "04_migrar_datos_fase1.js",
      "05_inicializar_telas_temporadas.js",
      "06_generar_pedidos_prueba.js",
      "07_verificar.js"
    ],
    "npm_scripts": {
      "migrate": "Runs scripts 01-06 in sequence",
      "verify": "Runs script 07 (verification)",
      "all": "Runs migrate && verify"
    }
  },
  "issues_resolved": [
    {
      "issue": "Negative stock prevention",
      "solution": "CHECK constraints on stock_nuevo >= 0, transaction rollback",
      "status": "resolved"
    },
    {
      "issue": "Verification script bugs",
      "solution": "Fixed table count (11→12), fixed column reference (pedidos.nombre→pedidos.id)",
      "status": "resolved"
    },
    {
      "issue": "Data normalization",
      "solution": "Implemented toTitleCase(), generatePrendaName(), activation logic",
      "status": "resolved"
    }
  ],
  "next_phase": {
    "id": 3,
    "name": "Fase 3: Tercera Forma Normal (3NF)",
    "goal": "Eliminate transitive dependencies",
    "potential_changes": [
      "Separate tipos_prenda to own table (if it has attributes)",
      "Normalize client addresses (table direcciones)",
      "Add payment methods (table metodos_pago)",
      "Add suppliers for fabrics (table proveedores)"
    ]
  },
  "metadata": {
    "created": "2025-10-22",
    "last_updated": "2025-10-22",
    "version": "2.0.0",
    "schema_version": "2NF"
  }
}
